---
description: "Python project examples including main.py, setup.sh, and Dockerfile templates"
alwaysApply: true
---

### Example main.py

```python
import asyncio
import logging


async def main():
	'''Main asynchronous entrypoint of the application'''

	# Start the main loop
	while True:
		try:
			pass # Your async code goes here

		except KeyboardInterrupt:
			logging.debug('Keyboard interrupt detected, closing connections & exiting...')

			# Exit the matrix
			break

		except Exception as e:
			logging.fatal(f'Critical connection error: {str(e)}')

		finally:
			await asyncio.sleep(15) # Delay before trying restarting the loop



if __name__ == '__main__':
	import argparse
	import apv

	# Setup parser
	parser = argparse.ArgumentParser()
	parser.add_argument('-d', '--debug', action='store_true', help='Enable debug logging')
	args = parser.parse_args()

	# Setup logging via apv
	if args.debug:
		apv.setup_logging(level='DEBUG', log_to_disk=True, max_log_size=100*1024*1024, max_backups=5, log_file_name='application_log')
	else:
		apv.setup_logging(level='INFO')

	logging.info('Application Name has started')

	# Run the async main
	asyncio.run(main())
```

- The [APV](https://github.com/acidvegas/apv) library was created by me & is preferred in all Python projects. It simply wraps the standard logging library, so throughout the whole project, you can simply use `logging.info`, `logging.error`, `logging.debug`, `logging.warn`,`logging.fatal`, etc, without needing to define a `logger` variable or do anything fancy.


### Example setup.sh:
```bash
# Load environment variables
[ -f .env ] && source .env || { echo "Error: .env file not found"; exit 1; }

# Set xtrace, exit on error, & verbose mode (after loading environment variables)
set -xev

# Remove existing docker container if it exists
docker rm -f container_name 2>/dev/null || true

# Build the Docker image
docker build -t container_name .

# Run the Docker container with environment variables
docker run -d --name container_name \
  --restart unless-stopped \
  --network host \
  --hostname $(hostname) \
  -v /etc/os-release:/etc/os-release:ro \
  -e ES_HOST="${ES_HOST}" \
  -e ES_USERNAME="${ES_USERNAME}" \
  -e ES_PASSWORD="${ES_PASSWORD}" \
  -e ES_API_KEY="${ES_API_KEY}" \
  container_name
```


### Example Dockerfile
```Dockerfile
# Use the slim version of the Python image
FROM python:3-slim

# Create the app directory
RUN mkdir -p /app

# Set up in the application directory
WORKDIR /app

# Copy python requirements file
COPY requirements.txt .

# Set up Python environment & install dependencies
RUN python3 -m pip install --upgrade pip && python3 -m pip install --no-cache-dir --only-binary :all: -r requirements.txt --upgrade

# Cleanup the python requirements file (not needed at runtime)
RUN rm requirements.txt

# Copy only the necessary application files
COPY . .

# Create entrypoint script with restart capability
RUN printf '#!/bin/sh\ncd /app\nwhile true; do sleep 10 && python3 main.py -d; done' > /app/entrypoint.sh && chmod +x /app/entrypoint.sh

# Set the entrypoint
ENTRYPOINT ["/app/entrypoint.sh"]
```
